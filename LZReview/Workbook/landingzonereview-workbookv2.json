{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# Azure Landing Zone Review"
      },
      "name": "header"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::selected"
        ],
        "parameters": [
          {
            "id": "f6fa63df-18c8-4ec9-942b-34fa2b7099ca",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "description": "Select subscription to check",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resourcecontainers\r\n| where type == \"microsoft.resources/subscriptions\"\r\n| order by name asc\r\n| extend rn=row_number()\r\n| project value = strcat('/subscriptions/', subscriptionId), label = name, selected = iif(rn == 1, true, false)",
            "crossComponentResources": [
              "value::selected"
            ],
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "headingparams"
    },
    {
      "type": 1,
      "content": {
        "json": "This workbook can be used to assess the components already deployed in the **{Subscription:label}** subscription(s), against recommended practises in alignment with the [Cloud Adoption Framework](https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/).",
        "style": "info"
      },
      "name": "infotext"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "7e08b44c-edaf-48cd-b81b-38d7473b4a79",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "About",
            "subTarget": "About",
            "style": "link"
          },
          {
            "id": "0d1b1df3-1085-4d04-bb5a-9c3fa2ac4874",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "Overview",
            "style": "link"
          },
          {
            "id": "eb3b5b59-7f91-4743-8b61-da82a7be1417",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Security, governance, and compliance",
            "subTarget": "Governance",
            "style": "link"
          },
          {
            "id": "1cf8e128-f2cb-4315-b34a-da2efa107f95",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Management and monitoring",
            "subTarget": "Monitoring",
            "style": "link"
          },
          {
            "id": "fc4ca8d6-e6a5-4b23-b01a-6b8e544f869a",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Identity and access management",
            "subTarget": "Identity",
            "style": "link"
          },
          {
            "id": "d39ed488-a5f9-477f-86c8-cdcf76114e31",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Network topology and connectivity",
            "subTarget": "Networking",
            "style": "link"
          },
          {
            "id": "01e247e8-d477-4ad5-91a8-f5b717ace1ad",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Resource Assessment",
            "subTarget": "Resources",
            "style": "link"
          }
        ]
      },
      "name": "TabLinks"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "Azure landing zones are the output of a multisubscription Azure environment that accounts for scale, security, governance, networking, and identity. Azure landing zones enable application migrations and greenfield development at enterprise-scale in Azure. These zones consider all platform resources that are required to support the customer's application portfolio and don't differentiate between infrastructure as a service or platform as a service.\r\n\r\n[Read more](https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/landing-zone/)",
              "style": "info"
            },
            "name": "text - 5"
          },
          {
            "type": 1,
            "content": {
              "json": "This status indicates that the current configuration is optimised or aligned with recommended practise.\r\n",
              "style": "success"
            },
            "customWidth": "50",
            "name": "successtext",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 1,
            "content": {
              "json": "This status indicates a feature that has has been implemented in a way that is not aligned with recommended practise.",
              "style": "warning"
            },
            "customWidth": "50",
            "name": "warningtext",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "About"
      },
      "name": "AboutGroup"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Azure Resources"
            },
            "name": "text - 5"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resourcecontainers\r\n| where type == \"microsoft.resources/subscriptions\"\r\n| summarize SubCount = count()",
              "size": 4,
              "title": "Count of Subscriptions",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "SubCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "subcount"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "summarize Resources=count()",
              "size": 4,
              "title": "All Azure Resources",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "Resources",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "countofallresources"
          },
          {
            "type": 1,
            "content": {
              "json": "## Security, governance, and compliance"
            },
            "name": "text - 6"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n| where type == \"microsoft.security/securescores\"\r\n| extend subScorePercentage = todouble(properties.score.current)/todouble(properties.score.max)\r\n| extend subScorePercentageXsubWeight = todouble(subScorePercentage)*todouble(properties.weight)\r\n| summarize upperValue = sum(subScorePercentageXsubWeight), underValue = sum(todouble(properties.weight))\r\n| extend overallScore = round(100*((upperValue)/(underValue)))\r\n| project overallScore",
              "size": 4,
              "title": "Secure Score Summary",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "overallScore",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 1,
                    "options": {
                      "style": "decimal"
                    }
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "securescoresummary"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "policyresources\r\n| where type == \"microsoft.policyinsights/policystates\"\r\n| extend AssignmentName = tostring(properties.policyAssignmentName)\r\n| summarize AssignmentCount = dcount(AssignmentName)",
              "size": 4,
              "title": "Policy Assignments",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "AssignmentCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "policycount"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\r\n| project tags, subscriptionId\r\n| where tags != \"{}\"\r\n| where tags != \"\"\r\n| where tags notcontains \"AutomationAccountARMID\"\r\n| where tags notcontains \"hidden-link\"\r\n| where tags notcontains \"hidden-title\"\r\n| where tags notcontains \"Azure Site Recovery Service\"\r\n| where tags notcontains \"azure-cloud-shell\"\r\n| mvexpand tags\r\n| parse tags with * '\"' TagName '\":\"' TagValue '\"' *\r\n| summarize TagCount = dcount(TagName)",
              "size": 4,
              "title": "Distinct Tags Assigned",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "TagCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "showPin": true,
            "name": "tagassignmentsummary"
          },
          {
            "type": 1,
            "content": {
              "json": "## Management and Monitoring"
            },
            "name": "text - 8"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.operationalinsights/workspaces\"\r\n| summarize WSCount = count()",
              "size": 4,
              "title": "Azure Monitor Logs Workspaces",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "WSCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "workspace-summary"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.insights/metricalerts\"\r\n| summarize Count = count()",
              "size": 4,
              "title": "Metric Alert Rules",
              "noDataMessage": "No Metric Alert rules detected in the selected subscriptions.",
              "noDataMessageStyle": 4,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "Count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "metricalerts-summary"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.insights/scheduledqueryrules\"\r\n| summarize Count = count()",
              "size": 4,
              "title": "Log-based Alert Rules",
              "noDataMessage": "No log-based alerts detected in the selected subscriptions",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "Count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "logalerts-summary"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.insights/datacollectionrules\"\r\n| summarize Count = count()",
              "size": 4,
              "title": "Data Collection Rules",
              "noDataMessage": "No Data Collection Rules detected in the selected subscriptions",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "Count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "datacollectionrules-summary"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "alertsmanagementresources\r\n| where type == \"microsoft.alertsmanagement/alerts\"\r\n| extend Status = tostring(properties.essentials.alertState)\r\n| where Status == \"New\"\r\n| summarize Count = count()",
              "size": 4,
              "title": "Current Active Alerts",
              "noDataMessage": "No Current Active Alerts detected.",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "Count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "alerts-summary"
          },
          {
            "type": 1,
            "content": {
              "json": "## Network Topology and Connectivity"
            },
            "name": "text - 9"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "where type == \"microsoft.network/virtualnetworks\"or type == \"microsoft.classicnetwork/virtualnetworks\"\r\n| summarize ['Virtual networks']=count()",
              "size": 4,
              "title": "Virtual Networks",
              "noDataMessage": "No Virtual Networks detected in the selected subscriptions",
              "noDataMessageStyle": 4,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "Virtual networks",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "vnetcount"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "where type == \"microsoft.network/networkinterfaces\"\r\n| summarize ['Network interfaces']=count()",
              "size": 4,
              "title": "Network Interfaces",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "Network interfaces",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "networkinterfaces"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "where type == \"microsoft.network/publicipaddresses\"\r\n| summarize ['Number of public IP addresses']=count()",
              "size": 4,
              "title": "Total Public IPs",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {},
                "leftContent": {
                  "columnMatch": "Number of public IP addresses",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "publicipaddresses"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "name": "OverviewTab"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Security, Governance and Compliance"
            },
            "name": "Governanceheader"
          },
          {
            "type": 1,
            "content": {
              "json": "This section covers planning for governance, defining security monitoring and an audit policy, and planning for platform security.\r\n\r\nRead more about [Enterprise-scale security, governance and compliance](https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/enterprise-scale/security-governance-and-compliance)",
              "style": "info"
            },
            "name": "text - 6"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "54ab9d43-70a4-40a2-8cdb-473594eced0b",
                  "cellValue": "selectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Security",
                  "subTarget": "Security1",
                  "preText": "Security",
                  "style": "link"
                },
                {
                  "id": "71459617-37ee-4d88-ba0c-27dc3f1ffd0c",
                  "cellValue": "selectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Governance",
                  "subTarget": "Governance1",
                  "style": "link"
                },
                {
                  "id": "59b84b1b-04b5-449d-8267-9373059118d8",
                  "cellValue": "selectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Compliance",
                  "subTarget": "Compliance",
                  "style": "link"
                }
              ]
            },
            "name": "links - 5"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### Security"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Azure Security Center has two main goals:\r\n\r\nto help you understand your current security situation\r\nto help you efficiently and effectively improve your security\r\nThe central feature in Security Center that enables you to achieve those goals is secure score.\r\n\r\nSecurity Center continually assesses your resources, subscriptions, and organization for security issues. It then aggregates all the findings into a single score so that you can tell, at a glance, your current security situation: the higher the score, the lower the identified risk level.\r\n\r\n[Read more about the Secure Score](https://docs.microsoft.com/en-us/azure/security-center/secure-score-security-controls)",
                    "style": "info"
                  },
                  "customWidth": "30",
                  "name": "securescoretext",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n| where type == \"microsoft.security/securescores\"\r\n| extend subScorePercentage = todouble(properties.score.current)/todouble(properties.score.max)\r\n| extend subScorePercentageXsubWeight = todouble(subScorePercentage)*todouble(properties.weight)\r\n| summarize upperValue = sum(subScorePercentageXsubWeight), underValue = sum(todouble(properties.weight)) by subscriptionId\r\n| extend overallScore = round(100*((upperValue)/(underValue)))",
                    "size": 1,
                    "title": "Azure Security Center Secure Score",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "overallScore",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 0,
                          "max": 100,
                          "palette": "redGreen"
                        },
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "subscriptionId",
                        "formatter": 15,
                        "formatOptions": {
                          "linkTarget": null,
                          "showIcon": true
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "70",
                  "name": "securescoreaggregate"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources \r\n| where type == \"microsoft.security/pricings\"\r\n| extend tier = trim(' ',tostring(properties.pricingTier))\r\n| project name,tier,subscriptionId",
                    "size": 0,
                    "title": "Azure Security Center/Azure Defender Status",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "tier",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Standard",
                                "representation": "success",
                                "text": "Azure Defender Enabled"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Free",
                                "representation": "2",
                                "text": "Azure Defender Excluded"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "40.4286ch"
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "subscriptionId"
                        ],
                        "expandTopLevel": true
                      },
                      "labelSettings": [
                        {
                          "columnId": "name",
                          "label": "Defender Capability"
                        },
                        {
                          "columnId": "tier",
                          "label": "Pricing Tier"
                        },
                        {
                          "columnId": "subscriptionId",
                          "label": "Subscription"
                        }
                      ]
                    }
                  },
                  "name": "ascenablement"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Security1"
            },
            "name": "SecurityGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Governance"
                  },
                  "name": "governancetext1"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Subscriptions are a unit of management, billing, and scale within Azure. They play a critical role when you're designing for large-scale Azure adoption.\r\n\r\nRead more about [Management group and subscription organization](https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/enterprise-scale/management-group-and-subscription-organization)",
                    "style": "info"
                  },
                  "name": "text - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resourcecontainers\r\n| where type == \"microsoft.resources/subscriptions\"\r\n| extend ManagementGroup = tostring(tags),\r\n\tspendingLimit = properties.subscriptionPolicies.spendingLimit,\r\n\tstate = properties.state,\r\n\tquotaId = properties.subscriptionPolicies.quotaId\r\n| parse kind = regex ManagementGroup with * @'(\\\"\\[\\\\\")' ManagementGroupName:string @'(\\\\\",\\\\\")' NextLevel:string\r\n| extend inManagementGroup = iif(ManagementGroupName==\"\", \"False\", \"True\")\r\n| project id, name, type, tenantId, inManagementGroup, ManagementGroupName, spendingLimit, state, quotaId",
                    "size": 0,
                    "title": "Azure Subscription Status",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "type",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "tenantId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "inManagementGroup",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "Available",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "False",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "spendingLimit",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "state",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Enabled",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "quotaId",
                          "formatter": 1
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "id",
                          "label": "Subscription"
                        },
                        {
                          "columnId": "name"
                        },
                        {
                          "columnId": "type"
                        },
                        {
                          "columnId": "tenantId"
                        },
                        {
                          "columnId": "inManagementGroup",
                          "label": "In Management Group"
                        },
                        {
                          "columnId": "ManagementGroupName",
                          "label": "Management Group Name"
                        },
                        {
                          "columnId": "spendingLimit",
                          "label": "Spending Limit"
                        },
                        {
                          "columnId": "state",
                          "label": "Status"
                        },
                        {
                          "columnId": "quotaId"
                        }
                      ]
                    }
                  },
                  "name": "subscriptionstatus"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### Are Azure Tags used to enrich Azure resources with operational metadata?\r\n  _Using tags can help to manage resources and make it easier to find relevant items during operational procedures._\r\n  > Azure Tags provide the ability to associate critical metadata as a name-value pair, such as billing information (e.g. cost center code), environment information (e.g. environment type), with Azure resources, resource groups, and subscriptions. See [Tagging Strategies](https://docs.microsoft.com/azure/cloud-adoption-framework/decision-guides/resource-tagging) for best practices.",
                    "style": "info"
                  },
                  "name": "tags-info"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n| project tags, subscriptionId\r\n| where tags != \"{}\"\r\n| where tags != \"\"\r\n| where tags notcontains \"AutomationAccountARMID\"\r\n| where tags notcontains \"hidden-link\"\r\n| where tags notcontains \"hidden-title\"\r\n| where tags notcontains \"Azure Site Recovery Service\"\r\n| where tags notcontains \"azure-cloud-shell\"\r\n| mvexpand tags\r\n| parse tags with * '\"' TagName '\":\"' TagValue '\"' *\r\n| summarize TagCount=count() by subscriptionId, TagName, TagValue\r\n| order by TagCount desc",
                    "size": 0,
                    "title": "Azure Tag Usage",
                    "noDataMessage": "No tags have been detected. Please consider implementing tags for easier organisation of your resources and billing purposes.",
                    "noDataMessageStyle": 2,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "TagCount",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "subscriptionId"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "tags",
                  "styleSettings": {
                    "padding": "1px"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Governance1"
            },
            "name": "governancegroup1"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Compliance"
                  },
                  "name": "compliance text"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "[Azure Policy](https://docs.microsoft.com/en-gb/azure/governance/policy/overview) helps to enforce organizational standards and to assess compliance at-scale. Through its compliance dashboard, it provides an aggregated view to evaluate the overall state of the environment, with the ability to drill down to the per-resource, per-policy granularity. It also helps to bring your resources to compliance through bulk remediation for existing resources and automatic remediation for new resources.\r\n\r\nRead more:\r\n* [Initial corporate policy behind the governance strategy](https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/govern/guides/complex/initial-corporate-policy)",
                    "style": "info"
                  },
                  "name": "text - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "policyresources\r\n| where type == \"microsoft.policyinsights/policystates\"\r\n| extend action = tostring(properties.policyDefinitionAction),\r\n\tAssignmentName = tostring(properties.policyAssignmentName),\r\n\tscope = tostring(properties.policyAssignmentScope),\r\n\tcompliancestate = tostring(properties.complianceState),\r\n\tcategory = tostring(properties.policySetDefinitionCategory),\r\n\tsubscription = tostring(properties.subscriptionId),\r\n\tgroupname = tostring(properties.policyDefinitionGroupNames)\r\n| summarize CompliantCount = countif(compliancestate == \"Compliant\"), NonCompliantCount = countif(compliancestate == \"NonCompliant\") by subscription, groupname, AssignmentName, scope",
                    "size": 0,
                    "title": "Azure Policy Assignments",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "subscription",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "AssignmentName",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "CompliantCount",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "green"
                          }
                        },
                        {
                          "columnMatch": "NonCompliantCount",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "red"
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "subscription"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "policyassignments"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Compliance"
            },
            "name": "Compliance Group"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "10",
            "name": "spacer"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Governance"
      },
      "name": "GovernanceGroup"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Management and Monitoring"
            },
            "name": "text - 8"
          },
          {
            "type": 1,
            "content": {
              "json": "This section explores how to operationally maintain an Azure enterprise estate with centralized management and monitoring at a platform level. More specifically, it presents key recommendations for central teams to maintain operational visibility within a large-scale Azure platform.\r\n\r\nRead more:\r\n* [Management and monitoring](https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/enterprise-scale/management-and-monitoring)\r\n* [Azure Management Guide: Before you start](https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/manage/azure-management-guide/)\r\n* [IT management and operations in the cloud](https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/manage/considerations/)\r\n* [Cloud monitoring guide: Introduction](https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/manage/monitor/)\r\n* [Azure Monitor overview](https://docs.microsoft.com/en-us/azure/azure-monitor/overview)",
              "style": "info"
            },
            "name": "text - 3"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "bef7125d-bc9c-437c-9f31-2dabb64c700c",
                  "cellValue": "selectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Monitoring",
                  "subTarget": "Monitoring",
                  "style": "link"
                },
                {
                  "id": "c20e4a4a-07bc-4130-a4cb-e0df08587036",
                  "cellValue": "selectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Automation Accounts",
                  "subTarget": "Automation",
                  "style": "link"
                },
                {
                  "id": "0296e1c4-5921-4de4-9265-48f70f129ba1",
                  "cellValue": "selectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Backup and Recovery",
                  "subTarget": "Backup",
                  "style": "link"
                }
              ]
            },
            "name": "links - 5"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### Monitoring"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type contains \"microsoft.operationalinsights\"\r\n| extend sku = properties.sku.name,\r\n\tcreatedDate = properties.createdDate,\r\n\tdataIngestionStatus = properties.workspaceCapping.dataIngestionStatus,\r\n\tdailyQuotaGb = tostring(properties.workspaceCapping.dailyQuotaGb),\r\n\tretentionInDays = properties.retentionInDays\r\n| extend sku = case(sku == \"pergb2018\", \"Per GB PAYG\", sku == \"standalone\", \"Legacy PAYG\", sku)\r\n| extend dailyQuotaGb = iff(dailyQuotaGb == \"-1.0\", \"No limit\", dailyQuotaGb)\r\n| project id, subscriptionId, name, location, resourceGroup, sku, createdDate, dataIngestionStatus, dailyQuotaGb, retentionInDays",
                    "size": 0,
                    "title": "Log Analytics workspaces",
                    "noDataMessage": "No Log Analytics workspaces detected in the selected subscription. If you have created your monitoring resources in another subscription, select that subscription in the subscription picker to view the details. If you have not created any workspaces, and want to leverage off the capabilities of Azure Monitor, please read the guidance here: https://docs.microsoft.com/en-us/azure/azure-monitor/platform/design-logs-deployment",
                    "noDataMessageStyle": 2,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "location",
                          "formatter": 17
                        },
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "sku",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "contains",
                                "thresholdValue": "Legacy",
                                "representation": "Important",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "createdDate",
                          "formatter": 6,
                          "dateFormat": {
                            "formatName": "longDatePattern"
                          }
                        },
                        {
                          "columnMatch": "dataIngestionStatus",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "retentionInDays",
                          "formatter": 1
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "subscriptionId"
                        ],
                        "expandTopLevel": true
                      },
                      "labelSettings": [
                        {
                          "columnId": "id",
                          "label": "Workspace"
                        },
                        {
                          "columnId": "name"
                        },
                        {
                          "columnId": "location",
                          "label": "Location"
                        },
                        {
                          "columnId": "resourceGroup",
                          "label": "Resource Group"
                        },
                        {
                          "columnId": "sku",
                          "label": "Licensing Model"
                        },
                        {
                          "columnId": "createdDate",
                          "label": "Created Date"
                        },
                        {
                          "columnId": "dataIngestionStatus",
                          "label": "Ingestion Status"
                        },
                        {
                          "columnId": "dailyQuotaGb",
                          "label": "Daily Ingestion Limit"
                        },
                        {
                          "columnId": "retentionInDays",
                          "label": "Retention in Days"
                        }
                      ]
                    }
                  },
                  "name": "lawspaces"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type == \"microsoft.operationsmanagement/solutions\"\r\n| extend workspace = properties.workspaceResourceId\r\n| project name, location, resourceGroup, workspace",
                    "size": 0,
                    "title": "Monitoring Solutions",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "location",
                          "formatter": 17
                        },
                        {
                          "columnMatch": "workspace",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "workspace"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "monitoringsolutions"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type contains \"microsoft.insights\"\r\n| summarize Count = count() by subscriptionId, type, resourceGroup\r\n| sort by type asc, Count desc, resourceGroup asc",
                    "size": 0,
                    "title": "Monitoring components created",
                    "noDataMessage": "No Monitoring resources detected in the selected subscription. If you have created your monitoring resources in another subscription, select that subscription in the subscription picker to view the details. If you have not created any workspaces, and want to leverage off the capabilities of Azure Monitor, please read the guidance here: https://docs.microsoft.com/en-us/azure/azure-monitor/overview",
                    "noDataMessageStyle": 2,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "type",
                          "formatter": 16,
                          "formatOptions": {
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "subscriptionId"
                        ],
                        "expandTopLevel": true
                      },
                      "labelSettings": [
                        {
                          "columnId": "type",
                          "label": "Resource Type"
                        },
                        {
                          "columnId": "resourceGroup",
                          "label": "Resource Group"
                        },
                        {
                          "columnId": "Count"
                        }
                      ]
                    }
                  },
                  "name": "azmonresources"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Monitoring"
            },
            "name": "Monitoring-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### Automation"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type == \"microsoft.automation/automationaccounts\"\r\n| extend creationTime = properties.creationTime\r\n| project id, name, location, resourceGroup, subscriptionId, creationTime",
                    "size": 0,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "linkIsContextBlade": true,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "location",
                          "formatter": 17,
                          "formatOptions": {
                            "customColumnWidthSetting": "75px"
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "creationTime",
                          "formatter": 6
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "subscriptionId"
                        ],
                        "expandTopLevel": true
                      },
                      "labelSettings": [
                        {
                          "columnId": "id",
                          "label": "Automation Account"
                        },
                        {
                          "columnId": "name"
                        },
                        {
                          "columnId": "location"
                        },
                        {
                          "columnId": "resourceGroup"
                        },
                        {
                          "columnId": "subscriptionId"
                        },
                        {
                          "columnId": "creationTime"
                        }
                      ]
                    }
                  },
                  "name": "query - 1"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Notes about Runbooks:\r\n\r\n* If you have Python2 runbooks, consider converting them to Python3\r\n* Any runbooks in a New status cannot be executed. Remember to publish these runbooks.",
                    "style": "info"
                  },
                  "customWidth": "20",
                  "name": "runbooks-text"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type == \"microsoft.automation/automationaccounts/runbooks\"\r\n| extend description = properties.description,\r\n\trunbookType = properties.runbookType,\r\n\tstate = properties.state\r\n| project id, name, description, runbookType, state, location, resourceGroup, subscriptionId",
                    "size": 0,
                    "title": "Runbooks",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "linkIsContextBlade": false,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "description",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "runbookType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "contains",
                                "thresholdValue": "Python2",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "state",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "contains",
                                "thresholdValue": "New",
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "subscriptionId"
                        ],
                        "expandTopLevel": true
                      },
                      "labelSettings": [
                        {
                          "columnId": "id",
                          "label": "Runbook Name"
                        },
                        {
                          "columnId": "name"
                        },
                        {
                          "columnId": "description",
                          "label": "Description"
                        },
                        {
                          "columnId": "runbookType",
                          "label": "Runbook Type"
                        },
                        {
                          "columnId": "state",
                          "label": "Status"
                        },
                        {
                          "columnId": "location",
                          "label": "Location"
                        },
                        {
                          "columnId": "resourceGroup",
                          "label": "Resource Group"
                        },
                        {
                          "columnId": "subscriptionId",
                          "label": "Subscription"
                        }
                      ]
                    }
                  },
                  "customWidth": "80",
                  "name": "runbooks"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type contains \"microsoft.automation/automationaccounts/configurations\"\r\n| extend description = properties.description,\r\n\tnodeConfigurationCount = properties.nodeConfigurationCount,\r\n\tstate = properties.state\r\n| project id, name, description, nodeConfigurationCount, state, location, resourceGroup, subscriptionId",
                    "size": 0,
                    "title": "DSC Configurations",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "description",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "nodeConfigurationCount",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "state",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "!=",
                                "thresholdValue": "Published",
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "location",
                          "formatter": 17
                        },
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "subscriptionId"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "dsc"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Automation"
            },
            "name": "Automation-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### Backup and Recovery"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type == \"microsoft.compute/virtualmachines\"\r\n| join (\r\nrecoveryservicesresources\r\n| where type == \"microsoft.recoveryservices/vaults/backupjobs\"\r\n| extend backupManagementType = tostring(properties.backupManagementType),\r\n\tentityFriendlyName = tostring(properties.entityFriendlyName),\r\n\toperationCategory = properties.operationCategory,\r\n\tdataSourceType = properties.dataSourceType,\r\n\tstatus = properties.status,\r\n\tstartTime = properties.startTime,\r\n\tendTime = properties.endTime\r\n) on $left.name == $right.entityFriendlyName\r\n| project id, name, location, resourceGroup, subscriptionId, status, startTime, endTime",
                    "size": 0,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "linkIsContextBlade": true,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "location",
                          "formatter": 17
                        },
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "subscriptionId"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "query - 1"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Backup"
            },
            "name": "Backup-group"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Monitoring"
      },
      "name": "MonitoringGroup"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Identity and RBAC"
            },
            "name": "text - 0"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| extend displayName = tostring(properties.displayName), \r\n    category = properties.metadata.categories,\r\n        status = tostring(properties.status.code),\r\n        link = tostring(properties.links.azurePortal)\r\n| where category contains \"IdentityAndAccess\"\r\n| distinct subscriptionId, displayName, status, strcat(\"https://\", link)\r\n| order by displayName asc",
              "size": 3,
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "displayName",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "60%"
                    }
                  },
                  {
                    "columnMatch": "status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Healthy",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unhealthy",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "NotApplicable",
                          "representation": "info",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Column1",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "category",
                    "formatter": 5
                  }
                ],
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "subscriptionId"
                  ],
                  "expandTopLevel": true
                },
                "labelSettings": [
                  {
                    "columnId": "subscriptionId"
                  },
                  {
                    "columnId": "displayName"
                  },
                  {
                    "columnId": "status"
                  }
                ]
              }
            },
            "name": "asc-identity-recommendations"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Identity"
      },
      "name": "Identitygroup"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Azure Networking"
            },
            "name": "text - 4"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "927ef709-5bc8-4fbe-b6cd-810b2b80035f",
                  "version": "KqlParameterItem/1.0",
                  "name": "vnetname",
                  "label": "VNet Naming Convention",
                  "type": 1,
                  "value": "-vnet",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "d9c563fe-2252-4cc1-b5f7-45a46da289e8",
                  "version": "KqlParameterItem/1.0",
                  "name": "Position",
                  "label": "Prefix or Suffix?",
                  "type": 2,
                  "isRequired": true,
                  "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n    { \\\"value\\\":\\\"startswith\\\", \\\"label\\\":\\\"Starting Position\\\", \\\"selected\\\":\\\"true\\\"},\\r\\n    { \\\"value\\\":\\\"endswith\\\", \\\"label\\\":\\\"Ending Position\\\" }\\r\\n]\",\"transformers\":null}",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "queryType": 8,
                  "value": "endswith"
                }
              ],
              "style": "pills",
              "queryType": 8
            },
            "name": "vnetassessparam"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\r\n| where type == \"microsoft.network/virtualnetworks\"\r\n| extend subnets = todynamic(properties.subnets)\r\n| mvexpand subnets\r\n| extend nsg = tostring(subnets.properties.networkSecurityGroup)\r\n| where isempty(nsg)\r\n| summarize count() by nsg",
              "size": 4,
              "title": "Count of Subnets without NSGs",
              "noDataMessage": "No subnets without network security group (NSG), good work !!",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "gridSettings": {
                "rowLimit": 1
              },
              "tileSettings": {
                "titleContent": {
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 2,
                "topContent": {
                  "columnMatch": "nsg",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "nodeIdField": "count_",
                "graphOrientation": 3,
                "showOrientationToggles": false,
                "nodeSize": null,
                "staticNodeSize": 100,
                "colorSettings": null,
                "hivesMargin": 5
              }
            },
            "customWidth": "20",
            "conditionalVisibility": {
              "parameterName": "count",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "Subnets Without NSG associated"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.network/virtualnetworks\"\r\n| extend subnets = todynamic(properties.subnets)\r\n| mvexpand subnets\r\n| extend nsg = subnets.properties.networkSecurityGroup\r\n| where isempty(nsg)\r\n| extend vnetnamecompliance = iif(name {Position} '{vnetname}', \"Good\", \"Bad\")\r\n| project VNetname=name,vnetnamecompliance, SubnetName=subnets.name, resourceGroup, location, CIDR=subnets.properties.addressPrefix, id",
              "size": 3,
              "title": "Subnets without network security group (NSG)",
              "noDataMessage": "No subnets without network security group (NSG), good work !!",
              "noDataMessageStyle": 3,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "VNetname",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "vnetnamecompliance",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Good",
                          "representation": "success",
                          "text": "Compliant"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Bad",
                          "representation": "2",
                          "text": "Not Compliant"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "resourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "location",
                    "formatter": 17
                  },
                  {
                    "columnMatch": "CIDR",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "endsWith",
                          "thresholdValue": "25",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "endsWith",
                          "thresholdValue": "26",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "endsWith",
                          "thresholdValue": "27",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "endsWith",
                          "thresholdValue": "28",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "id",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": "GenericDetails",
                      "linkIsContextBlade": true,
                      "showIcon": true
                    }
                  }
                ],
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "resourceGroup"
                  ],
                  "expandTopLevel": true
                },
                "labelSettings": [
                  {
                    "columnId": "VNetname"
                  },
                  {
                    "columnId": "vnetnamecompliance",
                    "label": "VNet Naming Compliance"
                  },
                  {
                    "columnId": "SubnetName"
                  },
                  {
                    "columnId": "resourceGroup"
                  },
                  {
                    "columnId": "location"
                  },
                  {
                    "columnId": "CIDR"
                  },
                  {
                    "columnId": "id"
                  }
                ]
              }
            },
            "name": "Subnets without network security group (NSG)"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources\r\n| where type == \"microsoft.network/virtualnetworkgateways\"\r\n| extend sku = todynamic(properties.sku)\r\n| project name, type, location, resourceGroup, sku.name, sku.tier, properties.gatewayType, properties.vpnType",
              "size": 0,
              "title": "Virtual Network Gateway List",
              "noDataMessage": "No Virtual Network Gateways found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ]
            },
            "name": "Virtual Network Gateway List"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Networking"
      },
      "name": "Networking Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Azure Resources"
            },
            "name": "text - 2"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "fb9735fb-d044-4be9-b765-59e2cc53dd8a",
                  "cellValue": "selectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Compute",
                  "subTarget": "Compute",
                  "style": "link"
                },
                {
                  "id": "dbb96031-4b04-4432-84fb-29a65d0b4357",
                  "cellValue": "selectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Storage",
                  "subTarget": "Storage",
                  "style": "link"
                }
              ]
            },
            "name": "links - 3"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type == \"microsoft.compute/virtualmachines\"\r\n| extend sku = tostring(properties.hardwareProfile.vmSize)\r\n| summarize skucount = count() by sku\r\n| order by skucount desc",
                    "size": 0,
                    "title": "Count of VMs by Type",
                    "showRefreshButton": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "sku",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "skucount",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "showPin": true,
                  "name": "vmskucount"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n    | where type =~ 'microsoft.compute/virtualmachines'\r\n    | project vmId = tolower(tostring(id)), vmName = name\r\n    | join (Resources\r\n        | where type =~ 'microsoft.network/networkinterfaces'\r\n        | mv-expand ipconfig=properties.ipConfigurations\r\n        | project vmId = tolower(tostring(properties.virtualMachine.id)), privateIp = ipconfig.properties.privateIPAddress, publicIpId = tostring(ipconfig.properties.publicIPAddress.id)\r\n        | join kind=leftouter (Resources\r\n            | where type =~ 'microsoft.network/publicipaddresses'\r\n            | project publicIpId = id, publicIp = properties.ipAddress\r\n        ) on publicIpId\r\n        | project-away publicIpId, publicIpId1\r\n        | summarize privateIps = make_list(privateIp), publicIps = make_list(publicIp) by vmId\r\n    ) on vmId\r\n    | project-away vmId1\r\n    | sort by vmName asc\r\n| where array_length(publicIps)>0",
                    "size": 0,
                    "title": "VMs with Public Ips directly assigned",
                    "noDataMessage": "No VMs with DIrectly assigned Public Ips - good work!!!",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "vmName",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "privateIps",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "publicIps",
                          "formatter": 1
                        }
                      ],
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "vmId",
                          "label": "Virtual Machine"
                        },
                        {
                          "columnId": "vmName"
                        },
                        {
                          "columnId": "privateIps",
                          "label": "Private IP Addresses"
                        },
                        {
                          "columnId": "publicIps",
                          "label": "Public IP Addresses"
                        }
                      ]
                    }
                  },
                  "name": "VMs with Public Ips directly assigned"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines' \r\n| where isnull(properties.storageProfile.osDisk.managedDisk)\r\n| project id, VMname = name, properties.hardwareProfile.vmSize, location, resourceGroup, Offer=properties.storageProfile.imageReference.offer, SKU=properties.storageProfile.imageReference.sku\r\n",
                    "size": 0,
                    "title": "Vms with Unmanaged Disk",
                    "noDataMessage": "We found no VMs using unmanaged disks",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "id",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "VMname",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "properties_hardwareProfile_vmSize",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "location",
                          "formatter": 17
                        },
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "Offer",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "SKU",
                          "formatter": 1
                        }
                      ],
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "id",
                          "label": "Virtual Machine"
                        },
                        {
                          "columnId": "VMname"
                        },
                        {
                          "columnId": "properties_hardwareProfile_vmSize",
                          "label": "VM Size"
                        },
                        {
                          "columnId": "location",
                          "label": "Location"
                        },
                        {
                          "columnId": "resourceGroup",
                          "label": "Resource Group"
                        },
                        {
                          "columnId": "SKU",
                          "label": "Storage Profile"
                        }
                      ]
                    }
                  },
                  "name": "Vms with Unmanaged Disk"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Compute"
            },
            "name": "ComputeGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources \r\n| where type =~ 'microsoft.storage/storageaccounts' | where properties['supportsHttpsTrafficOnly'] == 'false'\r\n|project name, id, type, kind, location, resourceGroup, sku.name",
                    "size": 0,
                    "title": "Secure Transfer Only Disabled",
                    "noDataMessage": "Good job!! No insecure storage accounts",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "name": "nonHTTPSStorageAccounts"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Storage"
            },
            "name": "StorageGroup"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Resources"
      },
      "name": "Compute Group"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "fromTemplateId": "ArmTemplates-/subscriptions/949ef534-07f5-4138-8b79-aae16a71310c/resourceGroups/lztest3/providers/microsoft.insights/workbooktemplates/Landing Zone Workbook Workbook resource 1",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}